(()=>{"use strict";class e{hits=0;constructor(e){this.length=e}hit(){this.hits++}isSunk(){return!(this.hits<this.length)}}class t{ships=[];constructor(e){this.grid=new Array(e),this.gridSize=e;for(let t=0;t<e;t++)this.grid[t]=Array(e).fill(0)}AddShipToGrid(t,i,r){if(1===r){if(!1===this.validVerticalInput(i,t))return!1;this.placeShipVertical(i,t,this.ships.length+1)}else{if(!1===this.validHorizontalInput(i,t))return!1;this.placeShipHorizontal(i,t,this.ships.length+1)}return this.ships.push(new e(t)),this.ships[this.ships.length-1],!0}placeShipHorizontal(e,t,i){for(let r=0;r<t;r++)this.grid[e.y][e.x+r]=i}placeShipVertical(e,t,i){for(let r=0;r<t;r++)this.grid[e.y+r][e.x]=i}AllSunk(){for(let e=0;e<this.ships.length;e++)if(!1===this.ships[e].isSunk())return!1;return!0}validHorizontalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y,e.x+i))return!1;return!0}validVerticalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y+i,e.x))return!1;return!0}validInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||0!==this.grid[e][t])}validShotInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||-1===this.grid[e][t])}ReceiveAttack(e){if(!this.validShotInput(e.y,e.x))throw new Error("Invalid Input");return 0===this.grid[e.y][e.x]?(this.grid[e.y][e.x]=-1,0):(this.ships[this.grid[e.y][e.x]-1].hit(),this.grid[e.y][e.x]=-1,1)}}class i{constructor(e,t){this.playerName=e,this.gameBoard=t}MakeMove(e){try{return this.gameBoard.ReceiveAttack(e)}catch{return-1}}}class r extends i{constructor(e,t){super(e,t),this.moves=[]}MakeRandomMove(){let e=this.getRandomInt(this.gameBoard.grid.length),t=this.getRandomInt(this.gameBoard.grid.length),i=this.getValidShot(e,t);return{status:this.MakeMove(i),coords:i}}getRandomInt(e){return Math.floor(Math.random()*e)}placeRandomShipsOnBoard(){let e=[5,4,3,3,2];for(let t=0;t<e.length;t++){let i=this.getRandomInt(2),r=0,s=0;1===i?(r=this.getRandomInt(this.gameBoard.grid.length),s=this.getRandomInt(this.gameBoard.grid.length-e[t])):(r=this.getRandomInt(this.gameBoard.grid.length-e[t]),s=this.getRandomInt(this.gameBoard.grid.length));let l={x:r,y:s};!1===this.gameBoard.AddShipToGrid(e[t],l,i)&&t--}}getValidShot(e,t){let i=t,r=e;if(-1!==this.gameBoard.grid[i][r])return{x:r,y:i};for(let e=t;e<this.gameBoard.grid.length+1;e++){e===this.gameBoard.grid.length&&(e=0);for(let t=0;t<this.gameBoard.grid.length;t++)if(-1!==this.gameBoard.grid[e][t])return{x:t,y:e}}}}function s(){let e=document.createElement("div");e.classList.add("board");let t=document.createElement("div");t.classList.add("name"),t.textContent="Player",e.appendChild(t);let i=document.createElement("div");i.classList.add("tiles");for(let e=0;e<10;e++)for(let t=0;t<10;t++){let r=document.createElement("div");r.classList.add("tile"),r.dataset.row=e,r.dataset.col=t,i.appendChild(r)}return e.appendChild(i),e}function l(e,t){e.querySelector(".name").textContent=t}let a,o=[],n=[5,4,3,3,2],d=0;const c=document.querySelector(".modal");document.querySelector(".modal-content");let h=new t(10),u=new t(10);const g=document.querySelector(".game");let m=s(),p=s();g.insertBefore(m,g.firstChild),g.appendChild(p);let f,y=m.querySelector(".tiles"),v=p.querySelector(".tiles"),S=document.querySelector("#PvE"),B=document.querySelector("#PvP");function L(e){[...e.children].forEach((e=>{e.classList.add("disabled")}))}S.addEventListener("click",(()=>{var e,t;console.log("selected Player Versus Computer"),c.style.display="none",l(m,"Computer"),l(p,"You"),L(y),a=0,t=h,[...(e=v).children].forEach((s=>{s.addEventListener("mouseover",f=function(){!function(e,t){o.forEach((e=>{e.classList.remove("hit"),e.classList.remove("valid")})),o=[];let i={x:+e.dataset.col,y:+e.dataset.row};o=0===a?function(e,t){let i=[];for(let r=0;r<n[d];r++){let s=e.x+r,l=t.querySelector(`[data-row="${e.y}"][data-col="${s}"]`);null==l||l.classList.contains("occupied")||i.push(l)}return console.log(i),i}(i,t):function(e,t){let i=[];for(let r=0;r<n[d];r++){let s=t.querySelector(`[data-row="${e.y+r}"][data-col="${e.x}"]`);null==s||s.classList.contains("occupied")||i.push(s)}return i}(i,t),o.length==n[d]?o.forEach((e=>{e.classList.add("valid")})):o.forEach((e=>{e.classList.add("hit")}))}(s,e)}),s.addEventListener("click",(()=>{let l={x:+s.dataset.col,y:+s.dataset.row};t.AddShipToGrid(n[d],l,a)&&(o.forEach((e=>{e.classList.add("occupied")})),d++,d===n.length&&(console.log("removing click from"+s),function(e){[...e.children].forEach((e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)})),L(v),function(e){[...e.children].forEach((e=>{e.classList.remove("disabled")}))}(y);let t=new r("Computer",u);t.placeRandomShipsOnBoard(),console.log(t.gameBoard);let s=new i("Player",t.gameBoard);console.log(s),t=new r("Computer",h),console.log(t),[...y.children].forEach((e=>{e.addEventListener("click",(()=>{if(console.log(s.gameBoard.AllSunk()),console.log(t.gameBoard.AllSunk()),!0!==s.gameBoard.AllSunk()&&!0!==t.gameBoard.AllSunk()){let i={x:+e.dataset.col,y:+e.dataset.row},r=s.MakeMove(i);if(1===r)e.classList.add("hit");else{if(0!==r)return void console.log("Bad Move");e.classList.add("miss")}s.gameBoard.AllSunk()&&console.log(s.playerName+"Wins");let l=t.MakeRandomMove(),a=v.querySelector(`[data-row="${l.coords.y}"][data-col="${l.coords.x}"]`);1===l.status?a.classList.add("hit"):a.classList.add("miss"),t.gameBoard.AllSunk()&&console.log(t.playerName+"Wins")}}))}))}(e)))}))}))})),B.addEventListener("click",(()=>{console.log("selected Player Versus Player"),console.log("Display player names"),c.style.display="none",a=0,L(y),addHoverPlacementToBoard(v,1)}))})();