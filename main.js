(()=>{"use strict";class e{hits=0;constructor(e){this.length=e}hit(){this.hits++}isSunk(){return!(this.hits<this.length)}}class t{ships=[];constructor(e){this.grid=new Array(e),this.gridSize=e;for(let t=0;t<e;t++)this.grid[t]=Array(e).fill(0)}AddShipToGrid(t,i,r){if(1===r){if(!1===this.validVerticalInput(i,t))return!1;this.placeShipVertical(i,t,this.ships.length+1)}else{if(!1===this.validHorizontalInput(i,t))return!1;this.placeShipHorizontal(i,t,this.ships.length+1)}return this.ships.push(new e(t)),this.ships[this.ships.length-1],!0}placeShipHorizontal(e,t,i){for(let r=0;r<t;r++)this.grid[e.y][e.x+r]=i}placeShipVertical(e,t,i){for(let r=0;r<t;r++)this.grid[e.y+r][e.x]=i}AllSunk(){for(let e=0;e<this.ships.length;e++)if(!1===this.ships[e].isSunk())return!1;return!0}validHorizontalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y,e.x+i))return!1;return!0}validVerticalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y+i,e.x))return!1;return!0}validInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||0!==this.grid[e][t])}validShotInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||-1===this.grid[e][t])}ReceiveAttack(e){if(!this.validShotInput(e.y,e.x))throw new Error("Invalid Input");return 0===this.grid[e.y][e.x]?(this.grid[e.y][e.x]=-1,0):(this.ships[this.grid[e.y][e.x]-1].hit(),this.grid[e.y][e.x]=-1,1)}}class i{constructor(e,t){this.playerName=e,this.gameBoard=t}MakeMove(e){try{return this.gameBoard.ReceiveAttack(e)}catch{return-1}}}class r extends i{constructor(e,t){super(e,t),this.moves=[]}MakeRandomMove(){let e=this.getRandomInt(this.gameBoard.grid.length),t=this.getRandomInt(this.gameBoard.grid.length),i=this.getValidShot(e,t);return{status:this.MakeMove(i),coords:i}}GenerateRandomMove(){let e=this.getRandomInt(this.gameBoard.grid.length),t=this.getRandomInt(this.gameBoard.grid.length);return this.getValidShot(e,t)}getRandomInt(e){return Math.floor(Math.random()*e)}placeRandomShipsOnBoard(){let e=[5,4,3,3,2];for(let t=0;t<e.length;t++){let i=this.getRandomInt(2),r=0,a=0;1===i?(r=this.getRandomInt(this.gameBoard.grid.length),a=this.getRandomInt(this.gameBoard.grid.length-e[t])):(r=this.getRandomInt(this.gameBoard.grid.length-e[t]),a=this.getRandomInt(this.gameBoard.grid.length));let n={x:r,y:a};!1===this.gameBoard.AddShipToGrid(e[t],n,i)&&t--}}getValidShot(e,t){let i=t,r=e;if(-1!==this.gameBoard.grid[i][r])return{x:r,y:i};for(let e=t;e<this.gameBoard.grid.length+1;e++){e===this.gameBoard.grid.length&&(e=0);for(let t=0;t<this.gameBoard.grid.length;t++)if(-1!==this.gameBoard.grid[e][t])return{x:t,y:e}}}}function a(){let e=document.createElement("div");e.classList.add("board");let t=document.createElement("div");t.classList.add("name"),t.textContent="Player",e.appendChild(t);let i=document.createElement("div");i.classList.add("tiles");for(let e=0;e<10;e++)for(let t=0;t<10;t++){let r=document.createElement("div");r.classList.add("tile"),r.dataset.row=e,r.dataset.col=t,i.appendChild(r)}return e.appendChild(i),e}function n(e,t){e.querySelector(".name").textContent=t}class s{players=[];constructor(e,t){this.players.push(e),this.players.push(t),this.currentPlayerIndex=0,this.currentPlayer=this.players[this.currentPlayerIndex]}MakeMove(e){let t;console.log(this.currentPlayer);let i=this.currentPlayer.MakeMove(e);if(1===i){if(t=1,console.log(this.currentPlayer.gameBoard.AllSunk()),!0!==this.currentPlayer.gameBoard.AllSunk())return this.switchPlayerTurn(),t;t=2}else 0===i?(t=0,this.switchPlayerTurn()):(console.log("Bad Move"),t=-1);return t}switchPlayerTurn(){this.currentPlayerIndex=++this.currentPlayerIndex%2,this.currentPlayer=this.players[this.currentPlayerIndex]}}function l(e){let t=document.createElement("div");return t.classList.add("game-choice"),t.textContent=e,t}function d(e,t){let i=document.createElement("div");return i.classList.add("game-button"),i.textContent=e,i.id=t,i}let o,h=[],c=[5,4,3,3,2],u=0;const g=document.querySelector(".modal");let m=function(){let e=l("Select Game Type"),t=d("Player vs Computer","PvE"),i=d("Player vs Player","PvP"),r=document.createElement("div");return r.classList.add("modal-content"),r.appendChild(e),r.appendChild(t),r.appendChild(i),r}();g.appendChild(m);let p=new t(10),f=new t(10);const y=document.querySelector(".game");let v=a(),S=a();y.insertBefore(v,y.firstChild),y.appendChild(S);let E=v.querySelector(".tiles"),L=S.querySelector(".tiles"),x=m.querySelector("#PvE"),C=m.querySelector("#PvP");function w(e){[...e.children].forEach((e=>{e.classList.add("disabled")}))}function I(e,t){void 0!==h&&h.forEach((e=>{e.classList.remove("hit"),e.classList.remove("valid")}));let i={x:+e.dataset.col,y:+e.dataset.row};h=0===o?function(e,t){let i=[];for(let r=0;r<c[u];r++){let a=e.x+r,n=t.querySelector(`[data-row="${e.y}"][data-col="${a}"]`);null==n||n.classList.contains("occupied")||i.push(n)}return i}(i,t):function(e,t){let i=[];for(let r=0;r<c[u];r++){let a=t.querySelector(`[data-row="${e.y+r}"][data-col="${e.x}"]`);null==a||a.classList.contains("occupied")||i.push(a)}return i}(i,t),h.length==c[u]?h.forEach((e=>{e.classList.add("valid")})):h.forEach((e=>{e.classList.add("hit")}))}function B(e){g.removeChild(g.firstChild);let t=function(e){let t=l(`${e} won!`),i=d("New Game","newgame"),r=document.createElement("div");return r.classList.add("modal-content"),r.appendChild(t),r.appendChild(i),r}(e);g.appendChild(t),g.style.display="flex",t.querySelector("#newgame"),t.addEventListener("click",P)}function P(){v=a(),S=a(),y.firstElementChild.remove(),y.lastElementChild.remove(),y.insertBefore(v,y.firstChild),y.appendChild(S),E=v.querySelector(".tiles"),L=S.querySelector(".tiles"),g.firstElementChild.remove(),g.appendChild(m),p=new t(10),f=new t(10),u=0}function k(e){console.log("Space"===e.code),o=0===o?1:0,h.length>0&&I(h[0],L)}x.addEventListener("click",(function(){var e,t;g.style.display="none",n(v,"Computer"),n(S,"You"),w(E),o=0,e=L,t=p,document.addEventListener("keydown",k),[...e.children].forEach((a=>{a.addEventListener("mouseover",(()=>{I(a,e)})),a.addEventListener("click",(()=>{let n={x:+a.dataset.col,y:+a.dataset.row};t.AddShipToGrid(c[u],n,o)&&(h.forEach((e=>{e.classList.add("occupied")})),u++,u===c.length&&function(e){[...e.children].forEach((e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)})),w(L),function(e){[...e.children].forEach((e=>{e.classList.remove("disabled")}))}(E);let t=new r("Computer",f);t.placeRandomShipsOnBoard();let a=new i("You",t.gameBoard);t=new r("Computer",p);let n=new s(a,t);[...E.children].forEach((e=>{e.addEventListener("click",(()=>{let i={x:+e.dataset.col,y:+e.dataset.row},r=n.MakeMove(i);if(2===r)return e.classList.add("hit"),void B(a.playerName);if(1===r)e.classList.add("hit");else{if(0!==r)return;e.classList.add("miss")}let s=t.GenerateRandomMove();r=n.MakeMove(s);let l=L.querySelector(`[data-row="${s.y}"][data-col="${s.x}"]`);if(2===r)return l.classList.add("hit"),void B(t.playerName);if(1===r)l.classList.add("hit");else{if(0!==r)return;l.classList.add("miss")}}))}))}(e))}))}))})),C.addEventListener("click",(function(){}))})();