(()=>{"use strict";class e{hits=0;constructor(e){this.length=e}hit(){this.hits++}isSunk(){return!(this.hits<this.length)}}class t{ships=[];constructor(e){this.grid=new Array(e),this.gridSize=e;for(let t=0;t<e;t++)this.grid[t]=Array(e).fill(0)}AddShipToGrid(t,i,l){if(1===l){if(!1===this.validVerticalInput(i,t))return!1;this.placeShipVertical(i,t,this.ships.length+1)}else{if(!1===this.validHorizontalInput(i,t))return!1;this.placeShipHorizontal(i,t,this.ships.length+1)}return this.ships.push(new e(t)),this.ships[this.ships.length-1],!0}placeShipHorizontal(e,t,i){for(let l=0;l<t;l++)this.grid[e.y][e.x+l]=i}placeShipVertical(e,t,i){for(let l=0;l<t;l++)this.grid[e.y+l][e.x]=i}AllSunk(){for(let e=0;e<this.ships.length;e++)if(!1===this.ships[e].isSunk())return!1;return!0}validHorizontalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y,e.x+i))return!1;return!0}validVerticalInput(e,t){for(let i=0;i<t;i++)if(!1===this.validInput(e.y+i,e.x))return!1;return!0}validInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||0!==this.grid[e][t])}validShotInput(e,t){return!(t>=this.gridSize||t<0||e>=this.gridSize||e<0||-1===this.grid[e][t])}ReceiveAttack(e){return this.validShotInput(e.y,e.x)?0===this.grid[e.y][e.x]?(this.grid[e.y][e.x]=-1,0):(this.ships[this.grid[e.y][e.x]-1].hit(),this.grid[e.y][e.x]=-1,1):-1}}class i{constructor(e,t){this.playerName=e,this.gameBoard=t}MakeMove(e){try{return this.gameBoard.ReceiveAttack(e)}catch{return-1}}}class l extends i{constructor(e,t){super(e,t),this.moves=[],this.lastShotHit=!1,this.lastShot=!1}MakeRandomMove(){let e;if(console.log(this.moves.length),this.moves.length>0)e=this.moves.shift();else{let t=this.getRandomInt(this.gameBoard.grid.length),i=this.getRandomInt(this.gameBoard.grid.length);e=this.getValidShot(t,i)}return this.gameBoard.grid[e.y][e.x]>=1&&(console.log("WE NEWHIT"),this.addHitMove(e)),e}GenerateRandomMove(){let e=this.getRandomInt(this.gameBoard.grid.length),t=this.getRandomInt(this.gameBoard.grid.length);return this.getValidShot(e,t)}getRandomInt(e){return Math.floor(Math.random()*e)}placeRandomShipsOnBoard(){let e=[5,4,3,3,2];for(let t=0;t<e.length;t++){let i=this.getRandomInt(2),l=0,a=0;1===i?(l=this.getRandomInt(this.gameBoard.grid.length),a=this.getRandomInt(this.gameBoard.grid.length-e[t])):(l=this.getRandomInt(this.gameBoard.grid.length-e[t]),a=this.getRandomInt(this.gameBoard.grid.length));let r={x:l,y:a};!1===this.gameBoard.AddShipToGrid(e[t],r,i)&&t--}}getValidShot(e,t){let i=t,l=e;if(-1!==this.gameBoard.grid[i][l])return{x:l,y:i};for(let e=t;e<this.gameBoard.grid.length+1;e++){e===this.gameBoard.grid.length&&(e=0);for(let t=0;t<this.gameBoard.grid.length;t++)if(-1!==this.gameBoard.grid[e][t])return{x:t,y:e}}}addHitMove(e){e.y-1>=0&&-1!==this.gameBoard.grid[e.y-1][e.x]&&(this.moves.some((t=>e.x===t.x&&e.y-1===t.y))||this.moves.push({x:e.x,y:e.y-1})),e.y+1<this.gameBoard.grid.length&&-1!==this.gameBoard.grid[e.y+1][e.x]&&(this.moves.some((t=>e.x===t.x&&e.y+1===t.y))||this.moves.push({x:e.x,y:e.y+1})),e.x-1>=0&&-1!==this.gameBoard.grid[e.y][e.x-1]&&(this.moves.some((t=>e.x-1===t.x&&e.y===t.y))||this.moves.push({x:e.x-1,y:e.y})),e.x+1<this.gameBoard.grid.length&&-1!==this.gameBoard.grid[e.y][e.x+1]&&(this.moves.some((t=>e.x+1===t.x&&e.y===t.y))||this.moves.push({x:e.x+1,y:e.y}))}}function a(){let e=document.createElement("div");e.classList.add("board");let t=document.createElement("div");t.classList.add("name"),t.textContent="Player",e.appendChild(t);let i=document.createElement("div");i.classList.add("tiles");for(let e=0;e<10;e++)for(let t=0;t<10;t++){let l=document.createElement("div");l.classList.add("tile"),l.dataset.row=e,l.dataset.col=t,i.appendChild(l)}return e.appendChild(i),e}function r(e,t){e.querySelector(".name").textContent=t}class s{players=[];constructor(e,t){this.players.push(e),this.players.push(t),this.currentPlayerIndex=0,this.currentPlayer=this.players[this.currentPlayerIndex]}MakeMove(e){let t;console.log(this.currentPlayer);let i=this.currentPlayer.MakeMove(e);return 1===i?(t=1,console.log(this.currentPlayer.gameBoard.AllSunk()),!0!==this.currentPlayer.gameBoard.AllSunk()?(this.switchPlayerTurn(),i):2):(0===i?this.switchPlayerTurn():console.log("Bad Move"),i)}switchPlayerTurn(){this.currentPlayerIndex=++this.currentPlayerIndex%2,this.currentPlayer=this.players[this.currentPlayerIndex]}}function n(e){let t=document.createElement("div");return t.classList.add("game-choice"),t.textContent=e,t}function d(e,t){let i=document.createElement("div");return i.classList.add("game-button"),i.textContent=e,i.id=t,i}let o,c,h,u,m=[],y=[5,4,3,3,2],p=0,g=0,v=!1,f=["Player One","Player Two"];const x=document.querySelector(".modal");let S=function(){let e=n("Select Game Type"),t=d("Player vs Computer","PvE"),i=d("Player vs Player","PvP"),l=document.createElement("div");return l.classList.add("modal-content"),l.appendChild(e),l.appendChild(t),l.appendChild(i),l}();x.appendChild(S);const E=document.querySelector("#next-turn"),L=document.querySelector(".control-message");E.addEventListener("click",(()=>{E.style.display="none",v=!1,h.querySelectorAll(".occupied-hidden").forEach((e=>{e.classList.remove("occupied-hidden"),e.classList.add("occupied")})),T(c)}));let C=new t(10),P=new t(10);const w=document.querySelector(".game");let B=a(),I=a();w.insertBefore(B,w.firstChild),w.appendChild(I);let k=B.querySelector(".tiles"),M=I.querySelector(".tiles"),q=S.querySelector("#PvE"),N=S.querySelector("#PvP");function R(e){[...e.children].forEach((e=>{e.classList.add("disabled")}))}function T(e){[...e.children].forEach((e=>{e.classList.remove("disabled")}))}function A(e,t,a){c=e,document.addEventListener("keydown",$),L.style.display="flex",L.textContent=f[g]+" Click to place ship. Press 'space' to rotate.",[...e.children].forEach((r=>{r.addEventListener("mouseover",(()=>{z(r,e)})),r.addEventListener("click",(()=>{let n={x:+r.dataset.col,y:+r.dataset.row};t.AddShipToGrid(y[p],n,o)&&(m.forEach((e=>{e.classList.add("occupied")})),p++,p===y.length&&(document.removeEventListener("keydown",$),a>0?(G(),1===a?(m=[],R(M),o=0,p=0,F(M),D(e),g=1,A(k,P,2)):(console.log("startPvPgame(tiles)"),function(){L.style.display="none",D(M),D(k),R(M),T(k),v=!0;let e=new i(f[0],P),t=new i(f[1],C);g=0,u=new s(e,t),h=M,c=k,O(h,c),F(k),[...k.children].forEach((t=>{t.addEventListener("click",(()=>{v||(h=k,c=M,H(t,0,e))}))})),[...M.children].forEach((e=>{e.addEventListener("click",(()=>{v||(h=M,c=k,H(e,1,t))}))}))}())):function(e){L.style.display="none",D(e),R(M),T(k);let t=new l("Computer",P);t.placeRandomShipsOnBoard();let a=new i("You",t.gameBoard);t=new l("Computer",C),u=new s(a,t),[...k.children].forEach((e=>{e.addEventListener("click",(()=>{let i={x:+e.dataset.col,y:+e.dataset.row},l=u.MakeMove(i);if(2===l)return e.classList.add("hit"),void b(a.playerName);if(1===l)e.classList.add("hit");else{if(0!==l)return;e.classList.add("miss")}let r=t.MakeRandomMove();l=u.MakeMove(r);let s=M.querySelector(`[data-row="${r.y}"][data-col="${r.x}"]`);if(console.log("moveresult :"+l+" coords : x : "+r.x+", y : "+r.y),2===l)return s.classList.add("hit"),void b(t.playerName);1===l?(s.classList.add("hit"),console.log("ADDING HIT")):0===l&&(console.log("ADDING MISS"),s.classList.add("miss"))}))}))}(e)))}))}))}function z(e,t){G();let i={x:+e.dataset.col,y:+e.dataset.row};m=0===o?function(e,t){let i=[];for(let l=0;l<y[p];l++){let a=e.x+l,r=t.querySelector(`[data-row="${e.y}"][data-col="${a}"]`);null==r||r.classList.contains("occupied")||i.push(r)}return i}(i,t):function(e,t){let i=[];for(let l=0;l<y[p];l++){let a=t.querySelector(`[data-row="${e.y+l}"][data-col="${e.x}"]`);null==a||a.classList.contains("occupied")||i.push(a)}return i}(i,t),m.length==y[p]?m.forEach((e=>{e.classList.add("valid")})):m.forEach((e=>{e.classList.add("hit")}))}function G(){void 0!==m&&m.forEach((e=>{e.classList.remove("hit"),e.classList.remove("valid")}))}function H(e,t,i){if(g===t){let t={x:+e.dataset.col,y:+e.dataset.row},l=u.MakeMove(t);if(2===l)return e.classList.add("hit"),void b(i.playerName);1===l?(e.classList.add("hit"),g=++g%2,O(c,h)):0===l&&(e.classList.add("miss"),g=++g%2,O(c,h))}}function O(e,t){v=!0,F(e),R(t),R(e),E.style.display="inline",E.textContent=f[g]+"'s turn"}function b(e){x.removeChild(x.firstChild);let t=function(e){let t=n(`${e} won!`),i=d("New Game","newgame"),l=document.createElement("div");return l.classList.add("modal-content"),l.appendChild(t),l.appendChild(i),l}(e);x.appendChild(t),x.style.display="flex",t.querySelector("#newgame"),t.addEventListener("click",V)}function V(){B=a(),I=a(),w.firstElementChild.remove(),w.lastElementChild.remove(),w.insertBefore(B,w.firstChild),w.appendChild(I),k=B.querySelector(".tiles"),M=I.querySelector(".tiles"),x.firstElementChild.remove(),x.appendChild(S),C=new t(10),P=new t(10),p=0}function $(e){o=0===o?1:0,m.length>0&&z(m[0],c)}function D(e){[...e.children].forEach((e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}))}function F(e){e.querySelectorAll(".occupied").forEach((e=>{e.classList.remove("occupied"),e.classList.add("occupied-hidden")}))}q.addEventListener("click",(function(){x.style.display="none",r(I,"You"),r(B,"Computer"),f[0]="",R(k),o=0,A(M,C,0)})),N.addEventListener("click",(function(){S.style.display="none";let e=function(){let e=n("Enter Player Names"),t=d("Play Game","playgame"),i=document.createElement("label");i.classList.add("label"),i.textContent="Player One Name",i.htmlFor="PlayerOneName";let l=document.createElement("input");l.placeholder="Player One",l.id="playeroneinput",l.Name="PlayerOneName",l.value="Player One";let a=document.createElement("label");a.classList.add("label"),a.textContent="Player Two Name",a.htmlFor="PlayerTneName";let r=document.createElement("input");r.placeholder="Player Two",r.id="playertwoinput",l.Name="PlayerTwoName",r.value="Player Two";let s=document.createElement("div");return s.classList.add("modal-content"),s.appendChild(e),s.appendChild(i),s.appendChild(l),s.appendChild(a),s.appendChild(r),s.appendChild(t),s}();x.appendChild(e);let t=e.querySelector("#playeroneinput"),i=e.querySelector("#playertwoinput");e.querySelector("#playgame").addEventListener("click",(()=>{let e=t.value,l=i.value;/\S/.test(e)||(e="Player One"),/\S/.test(l)||(l="Player Two"),f=[e,l],x.removeChild(x.lastElementChild),S.style.display="flex",r(I,f[0]),r(B,f[1]),x.style.display="none",o=0,g=0,R(k),c=M,A(M,C,1)}))}))})();